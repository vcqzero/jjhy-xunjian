<?php 
$identity = $this->identity();
$workyard_id = $this->User()->getWorkyardId($identity);
$UserEntity  = $this->User()->getEntityByIdentity($identity);
$user_id = $UserEntity->getId();

//获取某一巡检员是否有当前值班任务
$has_shifts_on_working= $this->ShiftGuard()->hasShiftsOnWorking($user_id, $workyard_id);
//获取某一巡检员是否有值班安排
$has_shifts_on_plan   = $this->ShiftGuard()->hasShiftsOnPlan($user_id, $workyard_id);

//test
// $ShiftEntityOnWorking = '';
// $has_shifts_on_working = false;
?>

<?php $this->placeholder('content')->captureStart();?>

<!-- 工地信息 -->
<?=$this->partial('guard/index/partial/workyard.phtml', [
    'workyard_id' => $workyard_id
])?>

<!-- 如果有值班任务 -->
<?php if($has_shifts_on_working) :?>

<!-- 值班安排 -->
<?=$this->partial('guard/index/partial/shift-on-working.phtml', [
    'user_id' => $user_id,
    'workyard_id' => $workyard_id,
])?>

<br/>

<?php elseif ($has_shifts_on_plan):?>
<!-- 显示几条值班安排 -->
<?=$this->partial('guard/index/partial/shift-on-plan.phtml', [
    'user_id' => $user_id,
    'workyard_id' => $workyard_id,
])?>
<?php else :?>

<!-- 无值班任务和安排 -->
<?=$this->partial('partial/weixin/empty/weui-msg.phtml', [
    'title' => '无内容',
    'desc' => '没有值班任务和值班安排',
])?>
<?php endif;?>

<?php $this->placeholder('content')->captureEnd();?>

<?=$this->partial('partial/weixin/page/basic-page.phtml', [
    'pageName'    => 'GuardIndexPage',
    'pageTitle'   => '巡检任务',
    'narbar'      => '',//指定导航条的url
//     'narbar'     => $this->placeholder('narbar'),
    'content'     => $this->placeholder('content'),
])?>
